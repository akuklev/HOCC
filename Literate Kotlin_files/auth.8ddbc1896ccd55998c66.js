var circlet;(()=>{"use strict";var e={d:(o,t)=>{for(var n in t)e.o(t,n)&&!e.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:t[n]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};e.r(o),e.d(o,{parseAndStoreResponse:()=>r});const t=navigator.userAgent.indexOf("AppleWebKit")>=0&&-1===navigator.userAgent.indexOf("Chrome");function n(e){try{e()}catch(o){console.error(o),console.log("Retrying to set localStorage items"),window.localStorage.clear(),e()}finally{if(t&&0===window.localStorage.length){console.warn("Clearing localStorage because it appears broken"),window.localStorage.clear();const e=navigator.userAgent.match("Version/\\d+.\\d+");if(3===e.length){const o=parseInt(e[1]),t=parseInt(e[2]);(o<16||16===o&&t<5)&&location.reload()}}}}async function r(e){try{const o=function(){const e=window.location.toString();return e&&e.replace(/^[^#]*#?/,"")}(),t=function(e){const o={};if(null!=e){const t=e=>decodeURIComponent(e.replace(/\+/g," "));e.split("&").forEach((e=>{const n=e.indexOf("="),r=n>=0?e.substring(0,n):e,i=n>=0?e.substring(n+1):"";o[t(r)]=t(i)}))}return o}(o),r=t.state;let i=null;if(r){let e="requested_"+r;i=window.localStorage.getItem(e),window.localStorage.removeItem(e)}if(t.error)return console.error(`OAuth authentication failed: ${t.error}: ${t.error_description}`),void n((()=>{window.localStorage.setItem(`${e}_error`,t.error),window.localStorage.setItem(`${e}_token`,null)}));const{expires_in:a,access_token:l,client_time:c}=t;if(!l){let t=`OAuth authentication response contains no access_token: ${o}`;return console.error(t),void n((()=>{window.localStorage.setItem(`${e}_error`,t),window.localStorage.setItem(`${e}_token`,null)}))}const s=a?parseInt(a,10):2400,d=1e3,w=c?parseInt(c,10):Date.now(),g=Math.round(w/d)+s;console.debug("[iframe-auth]: Set access token to local storage");const u=function(){let e=window.location.pathname.split("/");return e.length<2||"iframe-auth.html"!==e[2]?"":"-"+e[1]}();n((()=>{window.localStorage.setItem(`${e}${u}_expires`,new Date(1e3*g).toISOString()),window.localStorage.setItem(`${e}${u}_token`,l)})),function(){try{return window.self!==window.top}catch(e){return!0}}()||(i?i==window.location.origin||i.startsWith(window.location.origin+"/")?i.startsWith("http://")||i.startsWith("https://")?(console.debug(`Redirecting to ${i}`),window.location=i):(console.info(`Initially requested location seem to be not a HTTP/HTTPS URL: ${i}`),window.location="/"):(console.info(`Initially requested location seem to be of invalid origin: ${i}`),window.location="/"):(console.debug("Redirecting to root"),window.location="/"))}catch(o){console.error("exception",o),n((()=>{window.localStorage.setItem(`${e}_error`,o),window.localStorage.setItem(`${e}_token`,null)}))}}(circlet=void 0===circlet?{}:circlet).auth=o})();